\documentclass[a4paper,14pt]{extarticle}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{graphicx}
\usepackage{indentfirst}
\usepackage[top=0.8in, bottom=0.8in, left=0.8in, right=0.8in]{geometry}
\usepackage{pgfplots}
\usepackage{amsmath}
\usepackage{setspace}
\usepackage{titlesec}
\usepackage{pdfpages}
\usepackage{subcaption}
\usepackage{float}
\usepackage{longtable}
\usepackage{chngcntr}
\usepackage{pgfplots}
\usepackage{amsfonts}
\usepackage{hhline}
\usepackage{pgfplotstable}
\usepackage{multirow}
\usepackage{tikz,xcolor}
\usepackage{listings}

\lstset{ %
extendedchars=\true,
keepspaces=true,
language={[x86masm]Assembler},					% choose the language of the code
basicstyle=\footnotesize,		% the size of the fonts that are used for the code
numbers=left,					% where to put the line-numbers
numberstyle=\footnotesize,		% the size of the fonts that are used for the line-numbers
stepnumber=1,					% the step between two line-numbers. If it is 1 each line will be numbered
numbersep=10pt,					% how far the line-numbers are from the code
backgroundcolor=\color{white},	% choose the background color. You must add \usepackage{color}
showspaces=false, 			% show spaces adding particular underscores
showstringspaces=false,			% underline spaces within strings
showtabs=false,					% show tabs within strings adding particular underscores
frame=single,           		% adds a frame around the code
tabsize=4,						% sets default tabsize to 2 spaces
captionpos=b,					% sets the caption-position to bottom
breaklines=true,				% sets automatic line breaking
breakatwhitespace=false,		% sets if automatic breaks should only happen at whitespace
escapeinside={\%*}{*)},			% if you want to add a comment within your code
%postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{red}\hookrightarrow\space}}
}

\titleformat{\section}[hang]
  {\bfseries}
  {}
  {0em}
  {\hspace{-0.4pt}\large \thesection\hspace{0.6em}}
  
  
\titleformat{\subsection}[hang]
  {\bfseries}
  {}
  {0em}
  {\hspace{-0.4pt}\large \thesubsection\hspace{0.6em}}
  
\titleformat{\subsubsection}[hang]
  {\bfseries}
  {}
  {0em}
  {\hspace{-0.4pt}\large \thesubsubsection\hspace{0.6em}}

%\linespread{1.3} % полуторный интервал
%\renewcommand{\rmdefault}{ftm} % Times New Roman

\counterwithin{figure}{section}
\counterwithin{equation}{section}
\counterwithin{table}{section}

\begin{document}
\begin{titlepage}
\centering
Санкт-Петербургский политехнический университет Петра Великого \\
Институт компьютерных наук и технологий \\
Кафедра компьютерных систем и программных технологий \\
\vspace{5.5cm}

{\centering \textbf{Отчёт по лабораторной работе} \\ 
\vspace{0.15cm}
\textbf{Дисциплина}: Разработка сетевых приложений \\
\vspace{0.15cm}
\textbf{Тема}: IMAP-клиент } \\

\vspace{5.5cm}

\begin{table}[H]
\begin{tabular}{p{\textwidth}@{}r}
{Выполнили студенты гр. 43501/3} \hfill 
\vspace{0.2cm}
Мальцев М.С. \\ \hfill
\vspace{0.2cm}

Преподаватель \hfill 
\vspace{0.2cm}
Зозуля А.В \\ \hfill 
\vspace{0.2cm}

{} \hfill { <<\underline{\hspace{0.08\textwidth}}>> \underline{\hspace{0.2\textwidth}}2019 г.} \\
\end{tabular}
\end{table}
\vfill
{\centering Санкт-Петербург \\ 
\vspace{0.15cm}
2019}
\end{titlepage}

\section{Цель работы.}
Разработка IMAP-клиента.

\section{Ход работы}
\subsection{Архитекура приложения}
При разработке приложения было решено выделить четыре сущности:

\begin{enumerate}
    \item \textbf{View} - часть приложение, основная задача которой - это взаимодействие с пользователем. 
    Для написания этого компонента было решено использовать HTML, CSS и JS (чистый).
    \item \textbf{Http-Server} - выполняет задачу промежуточного слоя между компонентом View, с которым работают пользователи
    и компонентом IMAP-Client, который реализует основную функциональность приложения. Для создания этой части приложения был выбран язык Golang
    и библиотека для работы сетью "net". Она позволяет создать готовый http сервер, с помощью её пакета "net/http".
    \item \textbf{Database} - простой компонент, задача которого сохранить введеные пользователем данные аутентификации. Написан на языке Golang.
    \item \textbf{IMAP-Client} - основная часть приложения, задача которой установка соединения с IMAP сервером и получение
    от него почтовых данных, с последующей передачей их компоненту Http-server, с целью выведения их пользователю. Написан на языке Golang.
    Используются пакеты "crypto/tls"\ - для установки соедиения, пакет "mime" и несколько декодеров, для перевода текста письма в читаемый человеком вид.
\end{enumerate}

Также в приложении использовался пакет "github.com/logrusorgru/aurora"\ для дифференциации логов по цветам.

\newpage

На рисунке \ref{architecture} представлены связи между выделенными компонентами.

\begin{figure}[H]
	\begin{center}
		\includegraphics[scale=0.4]{pics/architecture}
		\caption{Компоненты приложения и связи между ними.}
		\label{architecture}
	\end{center}
\end{figure}

Таким образом, было решено создать веб-приложение, которое позволяет подключиться с помощью браузера
и получить почтовые данные из указанного IMAP сервера.

\subsection{Поддерживаемые команды IMAP протокола}
Реализованный IMAP клиент поддерживает следующие команды, соответствующие протоколу IMAP (RFC 3501):

\begin{itemize}
    \item login - передает IMAP-серверу аутентификационные данные пользователя.
    Используется при аутентификации пользователя в веб приложении,
    с целью сообщить ему в случае некорректности введенных данных.
    \item examine - команда, позволяющая выбрать почтовый ящик, с доступом только на чтение.
    \item select - команда, аналогичная examine, за исключением того, что ящик открывается и на чтение, и на запись.
    При использовании этой команды просмотренные письма автоматически помечаются флагом SEEN.
    \item fetch - команда, с помощью которой из почтового ящика извлекается необходимая информация.
    Используется, с целью  получить список, находящихся в ящике, писем с краткой информацией о них.
    Также  используется при получении полного текста письма.
    \item search - позволяет проводить операцию поиск. Возвращает номера писем, соответствующих условию поиска.
    Используется для обнаружения непрочитаных писем и для поиска письма с заданым UID.
    \item list - команда, выводящая список папок, расположенных на IMAP-сервере и соответствующих условиям поиска.
    Используется для получения всех папок сервера.
    \item logout - завершает обмен данными между IMAP-клиентом и IMAP-сервером.
\end{itemize}

С целью избежать зависания программы, в начале сессии обмена данными устанавливается таймер,
который через две секунды обрывает соединение.

\subsection{Графический интерфейс приложения}

На рисунках \ref{login}, \ref{spam}, \ref{letter} представлен графический интерфейс приложения.

\begin{figure}[H]
	\begin{center}
		\includegraphics[scale=0.4]{pics/login}
		\caption{Графический интерфейс приложения. Окно логина.}
		\label{login}
	\end{center}
\end{figure}

\begin{figure}[H]
	\begin{center}
		\includegraphics[scale=0.4]{pics/spam}
		\caption{Графический интерфейс приложения. Открыта папка Spam.}
		\label{spam}
	\end{center}
\end{figure}

\begin{figure}[H]
	\begin{center}
		\includegraphics[scale=0.55]{pics/letter}
		\caption{Графический интерфейс приложения. Отображение письма.}
		\label{letter}
	\end{center}
\end{figure}

Разработанный интерфейс отображает используемую, на данный момент,
почтовую папку и выделяет непрочитанные сообщения.
Окно логина уведомляет в случае, если пользователь забыл ввести данные в одну из форм
или он ввёл некорректные данные. При открытие письмо выглядит максимально минималистично.
На отдельные строчки вынесены такие поля, как дата, тема письма, от кого оно, кому предназначалось и собственно сам текст письма.

\subsection{Тестирование}

Для тестирования был выбран действующий почтовый сервер - imap.rambler.ru. Приложение подключалось к серверу imap.rambler.ru по порту 993.
С сервера извлекались почтовые данные, которые успешно отображались приложением. Также был проведен эксперимент с посылкой нового письма
на сервер, с помощью стороннего сервиса, и отображением его в разработаном приложении. Все проверки были успешно пройдены.

\section{Вывод}

В результате выполнения работы был создан IMAP-клиент. 
В процессе создания приложения был подробно изучен протокол IMAP и были закреплены знания, принципов функционирования почтовых сервисов.
Также, в связи с тем, что данные приходящие от почтового сервиса требовалось в понятном виде продемонстрировать пользователю,
были улучшены навыки работы с регулярными выражениями.
Разработанное приложение было протестировано в работе с реальным IMAP-сервером, тестирование подтвердило работоспособность.

\newpage

\section{Листинги}

\lstinputlisting{../main.go}
\lstinputlisting{../db/db.go}
\lstinputlisting{../imap/client.go}
\lstinputlisting{../imap/commands.go}
\lstinputlisting{../imap/parsers.go}
\lstinputlisting{../imap/read.go}
\lstinputlisting{../imap/utils.go}

\lstinputlisting{../templates/content.html}
\lstinputlisting{../templates/footer.html}
\lstinputlisting{../templates/header.html}
\lstinputlisting{../templates/index.html}
\lstinputlisting{../templates/letter.html}

\lstinputlisting{../public/main.css}
\lstinputlisting{../public/main.js}

\end{document}